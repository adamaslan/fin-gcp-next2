# Database & System Credentials Pattern Database
# For use with sensitive-data-scan skill

patterns:
  postgresql_connection_string:
    name: "PostgreSQL Connection String (with password)"
    regex: 'postgresql://[^:]+:[^@]+@[^/\s]+/[^\s]*'
    severity: CRITICAL
    examples:
      - "postgresql://admin:SuperSecret123@prod-db.neon.tech:5432/myapp"
      - "postgres://user:pass123@localhost:5432/testdb"
    false_positives:
      - "postgresql://[USER]:[PASS]@[HOST]:[PORT]/[DB]"
      - "postgresql://[USER]:[PASSWORD]@example.com/[DATABASE]"
    context:
      - "Neon PostgreSQL connection"
      - "AWS RDS PostgreSQL"
      - "Local development PostgreSQL"
    remediation: "Rotate password immediately and update all environments"
    risk: "Full database access with username/password exposed"

  mysql_connection_string:
    name: "MySQL Connection String (with password)"
    regex: 'mysql://[^:]+:[^@]+@[^/\s]+/[^\s]*'
    severity: CRITICAL
    examples:
      - "mysql://root:RootPassword123@db.example.com:3306/myapp"
    false_positives:
      - "mysql://[USER]:[PASS]@[HOST]/[DATABASE]"
    context:
      - "MySQL/MariaDB connection"
      - "AWS RDS MySQL"
    remediation: "Rotate database password"
    risk: "Full MySQL database access"

  mongodb_connection_string:
    name: "MongoDB Connection String (with password)"
    regex: 'mongodb(\+srv)?://[^:]+:[^@]+@[^\s]*'
    severity: CRITICAL
    examples:
      - "mongodb+srv://admin:myPassword@cluster0.mongodb.net/myapp"
      - "mongodb://user:pass123@localhost:27017/db"
    false_positives:
      - "mongodb+srv://[USER]:[PASS]@[CLUSTER].mongodb.net"
    context:
      - "MongoDB Atlas"
      - "Local MongoDB"
    remediation: "Rotate MongoDB password"
    risk: "Full MongoDB cluster access"

  db_password_assignment:
    name: "Database Password Assignment"
    regex: '(password|passwd|pwd|db_password)\s*[=:]\s*["\']?([^"\'\s\n]+)["\']?'
    severity: CRITICAL
    examples:
      - "password: npg_Hs0g5ypEPTzO"
      - "PASSWORD=SuperSecretPass123"
      - "db_password = 'mypassword123'"
    false_positives:
      - "password = password"
      - "password: [REDACTED]"
      - "password: [PASSWORD]"
      - "# password: (example)"
    context:
      - "Configuration files"
      - "Environment variables"
      - "YAML config"
    remediation: "Move to .env file (not version controlled)"
    risk: "Exposed database credentials"

  neon_password:
    name: "Neon Database Password"
    regex: 'npg_[A-Za-z0-9_]{20,}'
    severity: CRITICAL
    examples:
      - "npg_Hs0g5ypEPTzO"
      - "npg_abcdefghijklmnopqrstuvwxyz1234567890"
    false_positives:
      - "npg_[A-Z]{20}  # Example"
    context:
      - "Neon PostgreSQL password"
    remediation: "Reset password in Neon console"
    risk: "Neon database full access"

  ssh_private_key:
    name: "SSH Private Key"
    regex: '-----BEGIN\s+(RSA|DSA|EC|OPENSSH|ENCRYPTED)?\s*PRIVATE\s+KEY-----[\s\S]*?-----END\s+(RSA|DSA|EC|OPENSSH|ENCRYPTED)?\s*PRIVATE\s+KEY-----'
    severity: CRITICAL
    examples:
      - "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC1q8C7...\n-----END PRIVATE KEY-----"
    false_positives: []
    context:
      - "SSH keys in files"
      - "PEM files"
      - "Key pair backups"
    remediation: "Generate new SSH key pair; remove old key from servers"
    risk: "SSH access to any server using this key"

  aws_credentials_file:
    name: "AWS Credentials in Config"
    regex: '(aws_access_key_id|aws_secret_access_key)\s*=\s*[A-Za-z0-9/+=]{20,}'
    severity: CRITICAL
    examples:
      - "aws_access_key_id = AKIA1234567890ABCDEF"
      - "aws_secret_access_key = wJalrXUtnFEMI/K7MDENG+bPxRfiCYEXAMPLEKEY"
    false_positives:
      - "aws_access_key_id = [KEY_ID]"
    context:
      - ".aws/credentials file"
      - "Configuration in code"
    remediation: "Deactivate AWS credentials immediately"
    risk: "AWS account access; dependent on IAM permissions"

  gcp_service_account_key:
    name: "GCP Service Account Private Key"
    regex: '"private_key":\s*"[^"]*-----BEGIN PRIVATE KEY-----[^"]*"'
    severity: CRITICAL
    examples:
      - '"private_key": "-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQE...\\n-----END PRIVATE KEY-----\\n"'
    false_positives: []
    context:
      - "service-account.json file"
      - "GCP key backup"
    remediation: "Delete key in GCP Console; create new key"
    risk: "Full GCP service account access"

  gcp_service_account_json:
    name: "GCP Service Account JSON"
    regex: '"type":\s*"service_account"[\s\S]*?"private_key":'
    severity: CRITICAL
    examples:
      - '{"type": "service_account", "project_id": "my-project", ... "private_key": "..."}'
    false_positives: []
    context:
      - "service-account.json"
      - "GCP authentication keys"
    remediation: "Remove from repo; delete key in GCP Console"
    risk: "Full GCP project access"

  connection_string_with_credentials:
    name: "Generic Connection String with Credentials"
    regex: '(server|host|hostname|database|db)=([^;:\s]+)[^;\n]*(user|username|uid)=([^;:\s]+)[^;\n]*(password|pwd)=([^;:\s\n]+)'
    severity: CRITICAL
    examples:
      - "server=prod-db.example.com;user=admin;password=SecurePass123"
      - "host=localhost;database=mydb;uid=root;pwd=root123"
    false_positives:
      - "server=[HOST];user=[USER];password=[PASS]"
    context:
      - ".NET connection strings"
      - "ODBC connection strings"
      - "Configuration files"
    remediation: "Move to secure configuration; use .env variables"
    risk: "Database connection with exposed credentials"

  heroku_api_key:
    name: "Heroku API Key"
    regex: '[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
    severity: CRITICAL
    examples:
      - "12345678-1234-1234-1234-123456789012"
    false_positives:
      - "UUID v4 format (may be non-Heroku)"
      - "[API_KEY]"
    context:
      - "Heroku CLI config"
      - "Heroku API authentication"
    remediation: "Regenerate in Heroku Dashboard"
    risk: "Heroku account and deployment access"

  firebase_database_secret:
    name: "Firebase Database Secret"
    regex: 'firebase.*secret["\']?\s*[=:]\s*["\']?([A-Za-z0-9_-]{30,})["\']?'
    severity: CRITICAL
    examples:
      - "firebase_secret = 'abcdefghijklmnopqrstuvwxyz1234567890'"
    false_positives:
      - "firebase_secret = [REDACTED]"
    context:
      - "Firebase configuration"
      - ".env files"
    remediation: "Rotate database rules and re-authenticate"
    risk: "Firebase database bypass"

  jwt_secret:
    name: "JWT Secret Key"
    regex: '(jwt_secret|JWT_SECRET|jti|secret)\s*[=:]\s*["\']?([A-Za-z0-9_\-\.]{30,})["\']?'
    severity: CRITICAL
    examples:
      - "JWT_SECRET = 'my-super-secret-key-do-not-expose'"
      - "secret: dXRtU2VjcmV0S2V5Rm9yUHVycG9zZXM="
    false_positives:
      - "secret = [REDACTED]"
      - "# secret: example-key-format"
    context:
      - ".env files"
      - "Configuration"
      - "Authentication setup"
    remediation: "Rotate secret; re-sign all existing tokens"
    risk: "JWT token forgery; session hijacking"

  oauth_client_secret:
    name: "OAuth Client Secret"
    regex: 'client_secret["\']?\s*[=:]\s*["\']?([A-Za-z0-9_\-]{20,})["\']?'
    severity: CRITICAL
    examples:
      - "client_secret = 'dXQtY2xpZW50c2VjcmV0Zm9yb2F1dGg'"
    false_positives:
      - "client_secret = [REDACTED]"
    context:
      - "OAuth configuration"
      - "Google OAuth setup"
      - "Microsoft/GitHub OAuth"
    remediation: "Regenerate in OAuth provider console"
    risk: "OAuth token generation; user impersonation"

  encryption_key:
    name: "Encryption Key/Passphrase"
    regex: '(encryption_key|cipher_key|secret_key|app_key)\s*[=:]\s*["\']?([A-Za-z0-9_\-./+]{20,})["\']?'
    severity: CRITICAL
    examples:
      - "encryption_key = 'base64encodedsecretkeyhere'"
    false_positives:
      - "encryption_key = [KEY]"
    context:
      - ".env configuration"
      - "Laravel .env"
    remediation: "Rotate key; re-encrypt sensitive data"
    risk: "Ability to decrypt all encrypted data"

  api_key_generic:
    name: "Generic API Key Pattern"
    regex: '(api[_-]?key|apikey|access[_-]?key)\s*[=:]\s*["\']?([A-Za-z0-9_\-\.]{20,})["\']?'
    severity: WARNING
    examples:
      - "api_key: dXRzb21lYXBpa2V5aGVyZQ=="
      - "ACCESS_KEY = 'some-long-api-key-value'"
    false_positives:
      - "api_key = [KEY]"
      - "# api_key: example-format"
    context:
      - "Unknown service API keys"
      - "Configuration files"
    remediation: "Identify service; follow service-specific rotation process"
    risk: "Depends on service; may allow API usage"

